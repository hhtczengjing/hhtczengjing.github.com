<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Flutter开发初探</title>
  <meta name="description" content="Flutter是由谷歌创建的一个框架，用于构建“现代移动应用”。目前它还处于beta阶段，不过它的文档和相关工具十分齐全，有些移动应用已经在使用Flutter。">
  <meta name="author" content="Wei Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Flutter开发初探">
  <meta name="twitter:description" content="Flutter是由谷歌创建的一个框架，用于构建“现代移动应用”。目前它还处于beta阶段，不过它的文档和相关工具十分齐全，有些移动应用已经在使用Flutter。">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="Flutter开发初探">
  <meta property="og:description" content="Flutter是由谷歌创建的一个框架，用于构建“现代移动应用”。目前它还处于beta阶段，不过它的文档和相关工具十分齐全，有些移动应用已经在使用Flutter。">
  
  <link rel="icon" type="image/png" href="/assets/images/favicon.png" />
  <link href="/assets/images/favicon.png" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//cdn.bootcss.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://blog.devzeng.com/blog/hello-flutter.html">
  <link rel="alternate" type="application/rss+xml" title="曾静的博客" href="http://blog.devzeng.com/feed.xml">
  
  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />
  
</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="前往 曾静的博客 的主页" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="曾静的博客 logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for 曾静的博客" class="blog-button">曾静的博客</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">但行好事，莫问前程.</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">嗨，我是曾静 (@devzeng)，目前暂居深圳。</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        <p class="panel-cover__description">这是我用来记录平日学习笔记的地方，欢迎您的访问.</p>
        
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">博客</a></li>
                
                  <li class="navigation__item"><a href="/archives.html" target="_blank" title="历史文章归档">归档</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

  
  <!-- Weibo -->
  <li class="navigation__item">
    <a href="http://weibo.com/devzeng" title="@devzeng 的微博" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li>
  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/hhtczengjing" title="@hhtczengjing 的 Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  
  
  
  <!-- Twitter -->
  <li class="navigation__item">
    <a href="http://twitter.com/hhtczengjing" title="@hhtczengjing" target="_blank">
      <i class='social fa fa-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li>
  

  

  <!-- RSS -->
  <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:hhtczengjing@gmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-slate"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2018-11-11 18:46:37 +0800" itemprop="datePublished" class="post-meta__date date">2018-11-11</time> &#8226; <span class="post-meta__tags tags">iOS</span>
    </div>
    <h1 class="post-title">Flutter开发初探</h1>
  </header>

  <section class="post">
    <p><a href="https://flutter.io/">Flutter</a>是由谷歌创建的一个框架，用于构建“现代移动应用”。目前它还处于beta阶段，不过它的文档和相关工具十分齐全，有些移动应用已经在使用Flutter。</p>

<h3 id="开发环境搭建">开发环境搭建</h3>

<p>由于在国内访问Flutter有时可能会受到限制，可以通过如下的配置使用国内的镜像(可以在一定程度上加快下载的速度)：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PUB_HOSTED_URL=https://pub.flutter-io.cn
export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn
</code></pre></div></div>

<p>1、下载flutter</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 下载
git clone https://github.com/flutter/flutter.git

# 切换到最新的tag(当前最新的是v0.11.13)
git checkout v0.11.13
</code></pre></div></div>

<p>2、设置环境变量</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 设置环境变量
export PATH=`pwd`/flutter/bin:$PATH
</code></pre></div></div>

<p>3、安装依赖</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 安装依赖
flutter doctor
</code></pre></div></div>

<p>如果是第一次使用可能有如下提示：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[!] Android toolchain - develop for Android devices (Android SDK 28.0.1)
    ✗ Android licenses not accepted.  To resolve this, run: flutter doctor --android-licenses
[!] iOS toolchain - develop for iOS devices (Xcode 9.4.1)
    ✗ libimobiledevice and ideviceinstaller are not installed. To install, run:
        brew install --HEAD libimobiledevice
        brew install ideviceinstaller
    ✗ ios-deploy not installed. To install:
        brew install ios-deploy
[✓] Android Studio (version 3.1)
    ✗ Flutter plugin not installed; this adds Flutter specific functionality.
    ✗ Dart plugin not installed; this adds Dart specific functionality.
[!] IntelliJ IDEA Ultimate Edition (version 2017.3.3)
    ✗ Flutter plugin not installed; this adds Flutter specific functionality.
    ✗ Dart plugin not installed; this adds Dart specific functionality.
[!] Connected devices
    ! No devices available

! Doctor found issues in 4 categories.
</code></pre></div></div>

<p>按照上面的说明进行处理即可：</p>

<p>(1) 接受Android开发者协议</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>flutter doctor --android-licenses
</code></pre></div></div>

<p>(2) 安装一些必要的iOS的工具</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install --HEAD libimobiledevice
brew install ideviceinstaller
brew install ios-deploy
</code></pre></div></div>

<p>2、配置IDE</p>

<p>(1) 配置IDEA/Android Studio</p>

<p><code class="highlighter-rouge">Preferences -&gt; Plugins</code>搜索<code class="highlighter-rouge">Flutter</code>并安装插件</p>

<p>也可以到下面的地址去下载</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://plugins.jetbrains.com/
</code></pre></div></div>

<p>(2) 配置VS Code</p>

<p><code class="highlighter-rouge">View -&gt; Command Palette</code>输入<code class="highlighter-rouge">install</code>, 然后选择<code class="highlighter-rouge">Extensions: Install Extension action</code>, 在搜索框中输入<code class="highlighter-rouge">flutter</code>在搜索结果列表里面选择<code class="highlighter-rouge">Flutter</code>点击安装(install）即可，安装完成后选择OK重新启动VS Code。</p>

<p>3、初始化创建项目</p>

<p>命令行输入：<code class="highlighter-rouge">flutter create hello_flutter</code>，即可快速创建一个Flutter的项目, 创建完成后就可以通过如下方式快速运行：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 进入到工程目录
cd hello_flutter
# 打开iPhone模拟器
open -a Simulator
# 运行
flutter run
</code></pre></div></div>

<h3 id="如何编写flutter插件">如何编写Flutter插件</h3>

<p>1、创建模板工程</p>

<p>命令行执行如下命令：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>flutter create --template=plugin flutter_hybrid_router
</code></pre></div></div>

<p>2、实现Dart调用的代码</p>

<p>在<code class="highlighter-rouge">lib/flutter_hybrid_router.dart</code>中实现Flutter端调用的方法逻辑：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Future&lt;void&gt; openURL({String url, List parameters}) async {
    _channel.invokeMethod('openURL', {"url": url ?? "", "parameters": (parameters ?? [])});
}
</code></pre></div></div>

<p>3、实现iOS端的实现逻辑</p>

<p>实现<code class="highlighter-rouge">handleMethodCall:result:</code>方法, Flutter端dart代码调用Native的逻辑：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (void)handleMethodCall:(FlutterMethodCall *)call result:(FlutterResult)block {
    if ([@"openURL" isEqualToString:call.method]) {
        id arguments = call.arguments;
        if(arguments &amp;&amp; [arguments isKindOfClass:[NSDictionary class]]) {
            NSString *pattern = [arguments objectForKey:@"url"];
            NSArray *parameters = [arguments objectForKey:@"parameters"];
            if(!pattern || pattern.length &lt;= 0) {
                !block ? : block(nil);
                return;
            }
            NSString *url = pattern;
            if(parameters &amp;&amp; [parameters isKindOfClass:[NSArray class]] &amp;&amp; parameters.count &gt; 0) {
                url = [MGJRouter generateURLWithPattern:pattern parameters:parameters];
            }
            if(!url || url.length &lt;= 0) {
                !block ? : block(nil);
                return;
            }
            [MGJRouter openURL:url completion:^(id result) {
                !block ? : block(result);
            }];
        }
        else {
            !block ? : block(nil);
        }
    }
    else {
        !block ? : block(FlutterMethodNotImplemented);
    }
}
</code></pre></div></div>

<h3 id="集成到现有的项目中">集成到现有的项目中</h3>

<p>1、修改Podfile</p>

<p>修改ios目录下面的Podfile文件，在顶部新增两行配置</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>platform :ios, '8.0'
use_frameworks!
</code></pre></div></div>

<p>2、执行编译脚本</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo "===清理flutter历史编译==="
flutter clean

echo "===重新生成plugin索引==="
flutter packages get

echo "===生成App.framework和flutter_assets==="
flutter build ios --release

echo "===生成各个plugin的二进制库文件==="
cd ios/Pods
for plugin_name in "flutter_hybrid_router" "flutter_webview_plugin"
do
    echo "生成${plugin_name}.framework..."
    /usr/bin/env xcrun xcodebuild build -configuration Release ARCHS='arm64 armv7' -target ${plugin_name} BUILD_DIR=../../build/ios -sdk iphoneos -quiet
    /usr/bin/env xcrun xcodebuild build -configuration Debug ARCHS='x86_64' -target ${plugin_name} BUILD_DIR=../../build/ios -sdk iphonesimulator -quiet
    echo "合并${plugin_name}.framework..."
    lipo -create "../../build/ios/Debug-iphonesimulator/${plugin_name}/${plugin_name}.framework/${plugin_name}" "../../build/ios/Release-iphoneos/${plugin_name}/${plugin_name}.framework/${plugin_name}" -o "../../build/ios/Release-iphoneos/${plugin_name}/${plugin_name}.framework/${plugin_name}"
done
</code></pre></div></div>

<p>脚本执行完成之后，创建一个Flutter的文件夹，将生成的产物拷贝过来，文件结构如下所示：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
├── FlutterModule.podspec
└── Pod
    ├── Assets
    │   └── flutter_assets
    └── Framework
        ├── App.framework
        ├── Flutter.framework
        ├── flutter_hybrid_router.framework
        └── flutter_webview_plugin.framework
</code></pre></div></div>

<p>其中<code class="highlighter-rouge">FlutterModule.podspec</code>文件的内容如下：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Pod::Spec.new do |s|
  s.name         = "Flutter"
  s.version      = "0.1.0"
  s.summary      = "Flutter Demo"
  s.description  = &lt;&lt;-DESC
    Flutter Demo                
  DESC
  s.homepage     = "https://blog.devzeng.com"
  s.license      = "MIT"
  s.platform = :ios, '8.0'
  s.author       = { "zengjing" =&gt; "hhtczengjing@gmail.com" }
  s.source       = { :git =&gt; "", :tag =&gt; "#{s.version}" }
  s.resources = "Pod/Assets/*"
  s.vendored_frameworks = "Pod/Framework/**/*.framework"
  s.dependency 'MGJRouter', '~&gt; 0.10.0'
end
</code></pre></div></div>

<p>然后就可以直接在代码中引用了。</p>

<p>3、主工程中注册插件</p>

<p>(1) <code class="highlighter-rouge">AppDelegate</code>中实现<code class="highlighter-rouge">FlutterPluginRegistry</code>协议</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    // 注册插件
    [FlutterHybridRouterPlugin registerWithRegistrar:[self registrarForPlugin:@"FlutterHybridRouterPlugin"]];
    
    // TODO: 给每个插件发送消息
 
    return YES;
}
</code></pre></div></div>

<p>(2) 打开Flutter页面</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FlutterViewController *controller = [[FlutterViewController alloc] init];
[self.navigationController pushViewController:controller animated:YES];
</code></pre></div></div>

<p>(3) 实现OpenURL的协议</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[MGJRouter registerURLPattern:@"com.devzeng.demo://goback" toHandler:^(NSDictionary *routerParameters) {
   UIViewController *controller = nil; // 获取当前Flutter页面
   [controller.navigationController popViewControllerAnimated:YES];
}];
</code></pre></div></div>

<p>最后，本文的demo可以在下面找到：</p>

<p>(1) Flutter插件示例：<a href="https://github.com/hhtczengjing/flutter_hybrid_router_plugin.git"><code class="highlighter-rouge">flutter_hybrid_router</code></a></p>

<p>(2) Flutter示例项目：<a href="https://github.com/hhtczengjing/flutter_demo.git"><code class="highlighter-rouge">flutter_demo</code></a></p>

<p>(3) Flutter编译后的模块：<a href="https://github.com/hhtczengjing/flutter_module_example.git"><code class="highlighter-rouge">flutter_module_example</code></a></p>

<p>(4) Flutter集成到现有项目中的示例：<a href="https://github.com/hhtczengjing/flutter_ios_project_integrate.git"><code class="highlighter-rouge">flutter_ios_project_integrate</code></a></p>

<h3 id="参考资料">参考资料</h3>

<p>1、<a href="https://flutter.io/">Flutter官网</a></p>

<p>2、<a href="http://www.infoq.com/cn/articles/why-is-flutter-revolutionary">为什么说Flutter是革命性的？</a></p>

<p>3、<a href="https://www.stephenw.cc/2018/04/20/dart-getting-start/">认识Dart语言</a></p>

<p>4、<a href="https://www.stephenw.cc/2018/04/21/dart-var-types/">Dart的变量和类型</a></p>

<p>4、<a href="https://www.stephenw.cc/2018/04/23/dart-func/">Dart的函数</a></p>

<p>5、<a href="https://www.stephenw.cc/2018/04/25/dart-class/">Dart的类</a></p>

<p>6、<a href="https://www.stephenw.cc/2018/04/27/dart-generics/">Dart中的泛型</a></p>


  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">最近的文章</span>
       <h2 class="post-list__post-title post-title"><a href="/blog/install-mysql-in-docker.html" title="link to Docker安装MySQL数据库">Docker安装MySQL数据库</a></h2>
       <p class="excerpt">近期经常需要安装MySQL数据库，在此记录一下：1、初始化创建文件夹mkdir -p ~/docker/mysql/conf/mkdir -p ~/docker/mysql/data2、在conf目录下创建配置文件my.cnf[mysqld]character-set-server=utf8[client]default-character-set=utf8[mysql]default-character-set=utf83、安装docker run -d -p 3306:3306 \  ...&hellip;</p>
       <div class="post-list__meta"><time datetime="2018-12-20 18:46:37 +0800" class="post-list__meta--date date">2018-12-20</time> &#8226; <span class="post-list__meta--tags tags">Note</span><a class="btn-border-small" href=/blog/install-mysql-in-docker.html>继续阅读</a></div>
   </div>
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">更早的文章</span>
       <h2 class="post-list__post-title post-title"><a href="/blog/ios-cryptopp-encryption.html" title="link to iOS中使用cryptopp进行加解密">iOS中使用cryptopp进行加解密</a></h2>
       <p class="excerpt">Crypto++是一个免费开源的加解密库，支持一些非常丰富的加解密算法(如AES/RSA等)。如果要考虑到实现一套跨平台多端加解密效果一致可以考虑使用该库，当然使用各自平台提供的api也能实现。目前只提供了源码的方式，如果要集成到iOS的项目里面需要先编译成静态库，下面就5.6.2这个版本进行介绍：1.编译静态库(1) 下载源码git clone https://github.com/weidai11/cryptopp.gitgit checkout CRYPTOPP_5_6_2(2) 准...&hellip;</p>
       <div class="post-list__meta"><time datetime="2018-10-04 18:46:37 +0800" class="post-list__meta--date date">2018-10-04</time> &#8226; <span class="post-list__meta--tags tags">iOS</span><a class="btn-border-small" href=/blog/ios-cryptopp-encryption.html>继续阅读</a></div>
   </div>
   
</section>

<section class="post-comments">
  
  
  
  
</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">本站点采用<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享 署名-非商业性使用-相同方式共享 4.0 国际 许可协议</a></span>
        <span class="footer__copyright">由 <a href="https://jekyllrb.com">Jekyll</a> 于 2019-06-30 生成，感谢<a href="https://github.com">GitHub</a>为本站提供存储空间.</span>
        <span class="footer__copyright">本站由 <a href="http://blog.devzeng.com">@devzeng</a> 创建，采用 <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> 作为主题，您可以在 GitHub 找到<a href="https://github.com/hhtczengjing/hhtczengjing.github.com">本站源码</a> - &copy; 2019</span>
    </footer>
</section>
        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script type="text/javascript" src="/js/main.js"></script>



    
  </body>

</html>
